const DisplayItem = require('../../display-item.js');
const { logging } = require('@proceed/machine');

class LoggingTab extends DisplayItem {
  //  LOG
  constructor() {
    super('Logging', 'logging');
    this.content = `<!doctype html><html><head><meta charset="utf-8"><title>Logging</title><style>/*!
    Pure v2.0.6
    Copyright 2013 Yahoo!
    Licensed under the BSD License.
    https://github.com/pure-css/pure/blob/master/LICENSE
    */
    /*!
    normalize.css v | MIT License | git.io/normalize
    Copyright (c) Nicolas Gallagher and Jonathan Neal
    */
    /*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}html{font-family:sans-serif}.hidden,[hidden]{display:none!important}.pure-img{max-width:100%;height:auto;display:block}button{color:#000;background-color:#fff;border-radius:.2rem;border:.1rem solid grey;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);font-size:100%;padding:.4rem 1rem;text-decoration:none;display:inline-block;line-height:normal;white-space:nowrap;vertical-align:middle;text-align:center;cursor:pointer;-webkit-user-drag:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-appearance:button;text-transform:none;overflow:visible}button:hover{background-color:#fefffd;background-image:-webkit-gradient(linear,left top,left bottom,from(transparent),color-stop(40%,rgba(0,0,0,.05)),to(rgba(0,0,0,.1)));background-image:linear-gradient(transparent,rgba(0,0,0,.05) 40%,rgba(0,0,0,.1))}button:active{-webkit-box-shadow:0 0 0 1px rgba(0,0,0,.15) inset,0 0 6px rgba(0,0,0,.2) inset;box-shadow:inset 0 0 0 1px rgba(0,0,0,.15),inset 0 0 6px rgba(0,0,0,.2);border-color:#000}button:focus{outline:0}input,select,textarea{background-color:transparent;border-style:none;border-radius:0}select{border:.1rem solid rgba(0,0,0,.5);min-height:2.5rem;padding:.5rem 1rem;cursor:pointer}input{border-bottom:.1rem solid rgba(0,0,0,.8);min-height:2rem;-webkit-rtl-ordering:logical;writing-mode:horizontal-tb;-webkit-writing-mode:horizontal-tb;text-rendering:auto;letter-spacing:normal;word-spacing:normal;text-transform:none;text-indent:0;text-shadow:none;display:inline-block;text-align:start}input:active,input:focus{border-bottom:.2em solid #0094a0;caret-color:#0094a0;outline:none}input[type=text]{min-width:25rem}input[type=checkbox]{min-width:1.5rem;cursor:pointer}.primary{background:#0094a0;color:#fff}button.primary:hover{background-color:#00b8c9}.secondary{background:#574f4f;color:#fff}button.secondary:hover{background-color:#272727}.success{background:#4caf50}button.success:hover{background-color:#67dc6b}.info{background-color:#2196f3;color:#fff}button.info:hover{background-color:#0084f0}.warning{background:#fb8c00}button.warning:hover{background-color:#e97115}.error{background:#e64242;color:#fff}button.error:hover{background-color:#ff1e1e}#header{margin:1rem .5rem}.LogElem{margin:.1rem .5rem;box-shadow:0 0 .2rem -.15rem #bbb;border-radius:0;display:flex;flex-wrap:wrap}.data{margin:0 3px}.log-debug{background-color:rgba(255,235,206,.349)}.log-error>.level{color:red}.log-info>.level{color:green}.log-info>.warn{color:orange}#instance-select{display:none}.instance-container{padding:0}</style></head><body><div id="header"><select id="table-select"></select> <select id="instance-select"></select> <button class="primary" type="button" id="toggleBtn" onclick="toggleRefresh()">‚è∏</button></div><div><div id="LogRoot"></div></div><script>!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0),n(1),n(2),n(3),n(4);function o(e,t,n){let o=document.createElement(t);return e&&e.appendChild(o),n&&Object.keys(n).forEach((function(e){o.setAttribute(e,n[e])})),o}let r=!0;window.toggleRefresh=function(){document.getElementById("toggleBtn").innerHTML=a(r?"play":"pause"),r=!r};let c={info:"‚û§",debug:"üõ†",error:"‚ö†",trace:"üõ°",CORE:"‚óâ",SYSTEM:"‚öô",pause:"‚è∏",play:"‚ñ∂"};function a(e){let t=c[e];return t||e}const i=document.getElementById("LogRoot"),l=document.getElementById("table-select");l.addEventListener("change",({target:e})=>{f="No instance",p(e[e.selectedIndex].value),g(d)});const u=document.getElementById("instance-select");function s(){i&&r&&window.PROCEED_DATA.get("/logging/api/log").then(e=>{g(e)})}let d;u.addEventListener("change",({target:e})=>{f=e[e.selectedIndex].value,g(d)}),s(),window.setInterval(s,2e3);let f,m="standard";function p(e){m=e,u.style.display="standard"===e?"":"block"}function g(e){(function(e){if(!d)return!0;const t=Object.keys(d),n=Object.keys(e);return t.length!==n.length||t.some(e=>!n.includes(e))})(e)&&v(Object.keys(e),l,m),d=e,i.innerHTML="",e[m]||p("standard"),"standard"===m?e.standard.forEach(e=>{const[t]=Object.values(e);i.appendChild(y(t))}):function(e){const t={};e.forEach(e=>{[e]=Object.values(e),t[e.instanceId]||(t[e.instanceId]=[]),t[e.instanceId].push(e)}),v(["No instance",...Object.keys(t)],u,f),Object.values(t).forEach(e=>{if(f&&"No instance"!==f&&f!==e[0].instanceId)return;const t=o(i,"div",{class:"container instance-container"});o(t,"div",{class:"title-container"}).textContent=e[0].instanceId,e.forEach(e=>{t.appendChild(y(e))})})}(e[m])}function v(e,t,n){t.innerHTML="",e.forEach(e=>{const r=o(t,"option",{value:e});e===n&&r.setAttribute("selected",!0),r.textContent=e})}function y(e){let{msg:t,level:n,time:r,moduleName:c}=e;r=new Intl.DateTimeFormat("en-GB",{hour:"numeric",minute:"numeric",second:"numeric",year:"numeric",month:"numeric",day:"numeric"}).format(new Date(r));let i=o(null,"div",{class:"LogElem log-"+n});return o(i,"div",{class:"data level icon"}).textContent=function(e){let t=a(e);return t===e?"":t}(n),o(i,"div",{class:"data level time"}).textContent=r,o(i,"div",{class:"data level text"}).textContent=n.toUpperCase()+": ",o(i,"div",{class:"data moduleName text"}).textContent=c,o(i,"div",{class:"data msg"}).textContent=t,i}}]);</script></body></html>`;
  }

  getEndpoints() {
    return {
      // GET <engine>/logging/api/log ('logging' comes from DisplayItem.key)
      '/api/log': { get: this.getLogs.bind(this) },
    };
  }
  async getLogs() {
    return await logging.getAllLogTables();
  }
}

module.exports = LoggingTab;
